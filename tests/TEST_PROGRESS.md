# 测试进度跟踪表

最后更新: 2025-11-28

## 总体进度

- **总指令数**: 151
- **已实现**: 151 (100%)
- **已测试**: 0 (0%)
- **测试通过**: 0 (0%)

## 新增指令测试进度 (27条)

### P0 - 关键指令 (10条)

| 序号 | Opcode | 指令 | 频率 | 实现 | 单元测试 | 集成测试 | 状态 | 备注 |
|------|--------|------|------|------|----------|----------|------|------|
| 1 | 0x16 | ASL zp,X | 68 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 2 | 0xFE | INC abs,X | 66 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 3 | 0x0E | ASL abs | 53 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 4 | 0x36 | ROL zp,X | 46 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 5 | 0x5E | LSR abs,X | 40 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 6 | 0xE1 | SBC (ind,X) | 37 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 7 | 0xE5 | SBC zp | 33 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 8 | 0x56 | LSR zp,X | 30 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 9 | 0x3E | ROL abs,X | 29 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 10 | 0xF1 | SBC (ind),Y | 29 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |

**P0 进度**: 0/10 测试完成

### P1 - 重要指令 (10条)

| 序号 | Opcode | 指令 | 频率 | 实现 | 单元测试 | 集成测试 | 状态 | 备注 |
|------|--------|------|------|------|----------|----------|------|------|
| 11 | 0x65 | ADC zp | 28 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 12 | 0xF6 | INC zp,X | 26 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 13 | 0x4E | LSR abs | 24 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 14 | 0x1E | ASL abs,X | 22 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 15 | 0xDE | DEC abs,X | 22 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 16 | 0xD6 | DEC zp,X | 21 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 17 | 0x2E | ROL abs | 17 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 18 | 0xF5 | SBC zp,X | 17 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 19 | 0xED | SBC abs | 16 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 20 | 0x6D | ADC abs | 15 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |

**P1 进度**: 0/10 测试完成

### P2 - 一般指令 (7条)

| 序号 | Opcode | 指令 | 频率 | 实现 | 单元测试 | 集成测试 | 状态 | 备注 |
|------|--------|------|------|------|----------|----------|------|------|
| 21 | 0x6C | JMP ind | 14 | ✅ | ⬜ | ⬜ | 🚧 待测试 | 需测试页边界bug |
| 22 | 0x75 | ADC zp,X | 12 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 23 | 0x7E | ROR abs,X | 12 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 24 | 0x61 | ADC (ind,X) | 11 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 25 | 0x71 | ADC (ind),Y | 9 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 26 | 0x6E | ROR abs | 8 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |
| 27 | 0x76 | ROR zp,X | 5 | ✅ | ⬜ | ⬜ | 🚧 待测试 | |

**P2 进度**: 0/7 测试完成

## 测试里程碑

### 里程碑 1: P0 指令测试 (目标: 2025-12-01)
- [ ] 完成所有 P0 指令的单元测试
- [ ] 完成所有 P0 指令的集成测试
- [ ] 所有 P0 指令测试通过

### 里程碑 2: P1 指令测试 (目标: 2025-12-05)
- [ ] 完成所有 P1 指令的单元测试
- [ ] 完成所有 P1 指令的集成测试
- [ ] 所有 P1 指令测试通过

### 里程碑 3: P2 指令测试 (目标: 2025-12-10)
- [ ] 完成所有 P2 指令的单元测试
- [ ] 完成所有 P2 指令的集成测试
- [ ] 所有 P2 指令测试通过

### 里程碑 4: Donkey Kong 运行 (目标: 2025-12-15)
- [ ] Donkey Kong 能够启动
- [ ] 显示标题画面
- [ ] 游戏可玩

## 已知问题

### 高优先级
1. **CPU 跳转到向量表区域** - 运行几帧后 PC 跳转到 0xFFFA 等地址
   - 可能原因: 某个指令实现有 bug
   - 影响: 无法正常运行游戏
   - 状态: 🔴 待修复

### 中优先级
2. **栈指针异常变化** - SP 从 0xE2 → 0xC → 0x7B
   - 可能原因: 栈操作指令有问题
   - 影响: 可能导致程序崩溃
   - 状态: 🟡 调查中

### 低优先级
3. **性能优化** - 某些指令周期数可能不准确
   - 影响: 时序可能不完全准确
   - 状态: 🟢 可以稍后处理

## 测试环境

- **Scala 版本**: 2.12.x
- **Chisel 版本**: 3.5.x
- **Verilator 版本**: 5.042
- **操作系统**: macOS
- **测试框架**: ChiselTest, ScalaTest

## 测试命令快速参考

```bash
# 运行所有测试
./scripts/run_tests.sh

# 运行 P0 测试
python3 tests/run_instruction_tests.py --priority P0

# 运行单元测试
sbt test

# 运行特定测试
sbt "testOnly cpu6502.tests.InstructionTests"

# 编译 Verilator
./scripts/verilator_build.sh

# 运行 Donkey Kong
./scripts/verilator_run.sh games/Donkey-Kong.nes

# 分析指令覆盖率
python3 scripts/analyze_opcodes.py games/Donkey-Kong.nes
```

## 更新日志

### 2025-11-28
- ✅ 完成所有 27 条新指令的实现
- ✅ 更新指令分发器
- ✅ 创建测试框架和清单
- 🚧 开始测试工作

---

**图例说明**:
- ✅ 已完成
- ⬜ 未开始
- 🚧 进行中
- 🔴 高优先级问题
- 🟡 中优先级问题
- 🟢 低优先级问题
