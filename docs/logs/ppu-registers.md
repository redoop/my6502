# PPU 寄存器说明

## PPUMASK (0x2001) - PPU 掩码寄存器

控制 PPU 的渲染行为。

### 位定义

```
7  bit  0
---- ----
BGRs bMmG
|||| ||||
|||| |||+- 灰度模式 (0: 正常颜色; 1: 灰度)
|||| ||+-- 显示左侧 8 像素的背景 (0: 隐藏; 1: 显示)
|||| |+--- 显示左侧 8 像素的精灵 (0: 隐藏; 1: 显示)
|||| +---- 显示背景 (0: 隐藏; 1: 显示)
|||+------ 显示精灵 (0: 隐藏; 1: 显示)
||+------- 强调红色
|+-------- 强调绿色
+--------- 强调蓝色
```

### 常见值

- `0x00`: 所有渲染关闭
- `0x06`: 灰度模式 + 显示左侧背景和精灵（但背景和精灵本身未启用）
- `0x08`: 仅显示背景
- `0x10`: 仅显示精灵
- `0x18`: 显示背景和精灵（正常游戏模式）
- `0x1E`: 显示所有内容（背景、精灵、左侧 8 像素）

## 当前观察

### Donkey Kong 初始化过程

1. **阶段 1**: PPUMASK = 0x00
   - 所有渲染关闭
   - CPU 执行初始化代码

2. **阶段 2**: PPUMASK = 0x06 (观察到)
   - Bit 1: 显示左侧 8 像素的背景
   - Bit 2: 显示左侧 8 像素的精灵
   - 但 Bit 3 和 Bit 4 未设置，所以背景和精灵本身不显示
   - 这可能是一个中间状态

3. **阶段 3**: PPUMASK = 0x18 (预期)
   - Bit 3: 显示背景
   - Bit 4: 显示精灵
   - 游戏正式开始渲染

## 测试结果

### 2 分钟测试
- 总帧数: ~3403 帧
- PPUMASK: 0x06
- 渲染状态: 未启用

### 预期
需要更长时间（可能 5-10 分钟）才能看到 PPUMASK = 0x18，游戏开始渲染。

## PPUCTRL (0x2000) - PPU 控制寄存器

```
7  bit  0
---- ----
VPHB SINN
|||| ||||
|||| ||++- 基础名称表地址
|||| ||    (0 = $2000; 1 = $2400; 2 = $2800; 3 = $2C00)
|||| |+--- VRAM 地址增量 (0: +1; 1: +32)
|||| +---- 精灵图案表地址 (0: $0000; 1: $1000)
|||+------ 背景图案表地址 (0: $0000; 1: $1000)
||+------- 精灵大小 (0: 8x8; 1: 8x16)
|+-------- PPU 主/从选择
+--------- 在 VBlank 时生成 NMI (0: 关闭; 1: 开启)
```

### 常见值
- `0x80`: 启用 NMI
- `0x90`: 启用 NMI + 背景图案表在 $1000
- `0x10`: 背景图案表在 $1000（无 NMI）
