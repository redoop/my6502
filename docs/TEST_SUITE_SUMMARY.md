# 6502 æŒ‡ä»¤é›†æµ‹è¯•å¥—ä»¶æ€»ç»“

## ğŸ“‹ æ¦‚è¿°

å·²å®Œæˆ 6502 CPU çš„å®Œæ•´æµ‹è¯•æ¡†æ¶ï¼ŒåŒ…æ‹¬æµ‹è¯•æ–‡æ¡£ã€æµ‹è¯•ä»£ç å’Œè‡ªåŠ¨åŒ–è„šæœ¬ã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æµ‹è¯•æ–‡æ¡£ï¼ˆ5ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶ | è¡Œæ•° | æè¿° |
|------|------|------|
| `tests/TEST_CHECKLIST.md` | 500+ | è¯¦ç»†æµ‹è¯•æ¸…å•ï¼Œè¦†ç›–æ‰€æœ‰ 151 ç§æŒ‡ä»¤ |
| `tests/TEST_PROGRESS.md` | 200+ | æµ‹è¯•è¿›åº¦è·Ÿè¸ªè¡¨ |
| `tests/README.md` | 400+ | æµ‹è¯•æ–¹æ³•å’Œä½¿ç”¨è¯´æ˜ |
| `docs/TESTING_GUIDE.md` | 300+ | å®Œæ•´æµ‹è¯•æŒ‡å— |
| `tests/FILES_SUMMARY.md` | 250+ | æµ‹è¯•æ–‡ä»¶æ€»ç»“ |

**æ€»è®¡**: ~1650 è¡Œæ–‡æ¡£

### 2. æµ‹è¯•ä»£ç ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶ | è¯­è¨€ | æè¿° |
|------|------|------|
| `tests/instruction_tests.asm` | 6502 æ±‡ç¼– | æ±‡ç¼–æµ‹è¯•ç¨‹åº |
| `tests/run_instruction_tests.py` | Python | è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼ˆ200+ è¡Œï¼‰|
| `src/test/scala/InstructionTests.scala` | Scala | å•å…ƒæµ‹è¯•æ¡†æ¶ï¼ˆ150+ è¡Œï¼‰|
| `tests/example_test.scala` | Scala | æµ‹è¯•ç¤ºä¾‹å’Œæ¨¡æ¿ï¼ˆ150+ è¡Œï¼‰|

**æ€»è®¡**: ~500+ è¡Œä»£ç 

### 3. æµ‹è¯•è„šæœ¬ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶ | æè¿° |
|------|------|
| `scripts/run_tests.sh` | ä¸»æµ‹è¯•è¿è¡Œè„šæœ¬ï¼ˆ80+ è¡Œï¼‰|

## ğŸ“Š æµ‹è¯•æ¸…å•ç»Ÿè®¡

### æ–°å¢æŒ‡ä»¤ï¼ˆ27æ¡ï¼‰

#### æŒ‰ä¼˜å…ˆçº§åˆ†ç±»
- **P0ï¼ˆå…³é”®ï¼‰**: 10 æ¡æŒ‡ä»¤ï¼Œä½¿ç”¨é¢‘ç‡ >25æ¬¡
- **P1ï¼ˆé‡è¦ï¼‰**: 10 æ¡æŒ‡ä»¤ï¼Œä½¿ç”¨é¢‘ç‡ 10-25æ¬¡
- **P2ï¼ˆä¸€èˆ¬ï¼‰**: 7 æ¡æŒ‡ä»¤ï¼Œä½¿ç”¨é¢‘ç‡ <10æ¬¡

#### æŒ‰æŒ‡ä»¤ç±»å‹åˆ†ç±»
- **ç§»ä½æŒ‡ä»¤**: 12 æ¡ï¼ˆASL, LSR, ROL, RORï¼‰
- **ç®—æœ¯æŒ‡ä»¤**: 14 æ¡ï¼ˆADC, SBC, INC, DECï¼‰
- **è·³è½¬æŒ‡ä»¤**: 1 æ¡ï¼ˆJMP indirectï¼‰

#### æŒ‰å¯»å€æ¨¡å¼åˆ†ç±»
- **é›¶é¡µ X ç´¢å¼•**: 8 æ¡
- **ç»å¯¹å¯»å€**: 4 æ¡
- **ç»å¯¹ X ç´¢å¼•**: 6 æ¡
- **é›¶é¡µ**: 2 æ¡
- **é—´æ¥ X**: 2 æ¡
- **é—´æ¥ Y**: 2 æ¡
- **é—´æ¥**: 1 æ¡

### å…¨éƒ¨æŒ‡ä»¤ï¼ˆ151æ¡ï¼‰

æµ‹è¯•æ¸…å•è¦†ç›–æ‰€æœ‰ 6502 æŒ‡ä»¤ï¼š
- **ç®—æœ¯æŒ‡ä»¤**: 26 æ¡
- **ç§»ä½æŒ‡ä»¤**: 20 æ¡
- **é€»è¾‘æŒ‡ä»¤**: 24 æ¡
- **æ¯”è¾ƒæŒ‡ä»¤**: 18 æ¡
- **åˆ†æ”¯æŒ‡ä»¤**: 8 æ¡
- **åŠ è½½/å­˜å‚¨**: 33 æ¡
- **æ ˆæŒ‡ä»¤**: 4 æ¡
- **æ ‡å¿—æŒ‡ä»¤**: 7 æ¡
- **ä¼ é€æŒ‡ä»¤**: 6 æ¡
- **è·³è½¬æŒ‡ä»¤**: 5 æ¡

## ğŸ¯ æµ‹è¯•è¦ç‚¹

### æ¯æ¡æŒ‡ä»¤çš„æµ‹è¯•è¦†ç›–

1. **åŠŸèƒ½æ­£ç¡®æ€§**
   - åŸºæœ¬æ“ä½œæ­£ç¡®
   - è¾¹ç•Œæƒ…å†µå¤„ç†
   - ç‰¹æ®Šæƒ…å†µï¼ˆå¦‚ JMP indirect çš„é¡µè¾¹ç•Œ bugï¼‰

2. **æ ‡å¿—ä½è®¾ç½®**
   - è¿›ä½æ ‡å¿—ï¼ˆCï¼‰
   - é›¶æ ‡å¿—ï¼ˆZï¼‰
   - è´Ÿæ ‡å¿—ï¼ˆNï¼‰
   - æº¢å‡ºæ ‡å¿—ï¼ˆVï¼‰

3. **å¯»å€æ¨¡å¼**
   - åœ°å€è®¡ç®—æ­£ç¡®
   - ç´¢å¼•å¯„å­˜å™¨ä½¿ç”¨æ­£ç¡®
   - é¡µè¾¹ç•Œå¤„ç†

4. **æ—¶åº**
   - å‘¨æœŸæ•°æ­£ç¡®
   - å†…å­˜è®¿é—®æ—¶åºæ­£ç¡®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æŸ¥çœ‹æµ‹è¯•æ¸…å•

```bash
# æŸ¥çœ‹å®Œæ•´æµ‹è¯•æ¸…å•
cat tests/TEST_CHECKLIST.md

# æŸ¥çœ‹æµ‹è¯•è¿›åº¦
cat tests/TEST_PROGRESS.md

# æŸ¥çœ‹æµ‹è¯•æŒ‡å—
cat docs/TESTING_GUIDE.md
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./scripts/run_tests.sh

# è¿è¡Œ P0ï¼ˆå…³é”®ï¼‰æŒ‡ä»¤æµ‹è¯•
python3 tests/run_instruction_tests.py --priority P0

# è¿è¡Œå•å…ƒæµ‹è¯•
sbt test

# æµ‹è¯• Donkey Kong
./scripts/test_donkey_kong.sh
```

## ğŸ“ˆ æµ‹è¯•è¿›åº¦

### å½“å‰çŠ¶æ€

- âœ… **æŒ‡ä»¤å®ç°**: 151/151 (100%)
- âœ… **æµ‹è¯•æ¡†æ¶**: å®Œæˆ
- âœ… **æµ‹è¯•æ–‡æ¡£**: å®Œæˆ
- ğŸš§ **å•å…ƒæµ‹è¯•**: 0/27 (0%)
- ğŸš§ **é›†æˆæµ‹è¯•**: å¾…è¿è¡Œ
- â¬œ **æ¸¸æˆæµ‹è¯•**: å¾…è°ƒè¯•

### æµ‹è¯•é‡Œç¨‹ç¢‘

#### é‡Œç¨‹ç¢‘ 1: P0 æŒ‡ä»¤æµ‹è¯•ï¼ˆç›®æ ‡: 2025-12-01ï¼‰
- [ ] å®Œæˆ 10 æ¡ P0 æŒ‡ä»¤çš„å•å…ƒæµ‹è¯•
- [ ] æ‰€æœ‰ P0 æŒ‡ä»¤æµ‹è¯•é€šè¿‡
- [ ] ä¿®å¤å‘ç°çš„ bug

#### é‡Œç¨‹ç¢‘ 2: P1 æŒ‡ä»¤æµ‹è¯•ï¼ˆç›®æ ‡: 2025-12-05ï¼‰
- [ ] å®Œæˆ 10 æ¡ P1 æŒ‡ä»¤çš„å•å…ƒæµ‹è¯•
- [ ] æ‰€æœ‰ P1 æŒ‡ä»¤æµ‹è¯•é€šè¿‡

#### é‡Œç¨‹ç¢‘ 3: P2 æŒ‡ä»¤æµ‹è¯•ï¼ˆç›®æ ‡: 2025-12-10ï¼‰
- [ ] å®Œæˆ 7 æ¡ P2 æŒ‡ä»¤çš„å•å…ƒæµ‹è¯•
- [ ] æ‰€æœ‰ P2 æŒ‡ä»¤æµ‹è¯•é€šè¿‡

#### é‡Œç¨‹ç¢‘ 4: Donkey Kong è¿è¡Œï¼ˆç›®æ ‡: 2025-12-15ï¼‰
- [ ] æ¸¸æˆèƒ½å¤Ÿå¯åŠ¨
- [ ] æ˜¾ç¤ºæ ‡é¢˜ç”»é¢
- [ ] æ¸¸æˆå¯ç©

## ğŸ” æµ‹è¯•æ–¹æ³•

### 1. å•å…ƒæµ‹è¯•ï¼ˆScala/Chiselï¼‰

**ä¼˜ç‚¹**: å¿«é€Ÿã€ç²¾ç¡®ã€æ˜“äºè°ƒè¯•

**ç¤ºä¾‹**:
```scala
"ASL zp,X (0x16)" should "correctly shift left" in {
  test(new CPU6502Core) { dut =>
    // æµ‹è¯•é€»è¾‘
  }
}
```

### 2. é›†æˆæµ‹è¯•ï¼ˆVerilatorï¼‰

**ä¼˜ç‚¹**: çœŸå®ç¡¬ä»¶è¡Œä¸ºã€å®Œæ•´ç³»ç»Ÿæµ‹è¯•

**è¿è¡Œ**:
```bash
./scripts/verilator_build.sh
./scripts/verilator_run.sh games/Donkey-Kong.nes
```

### 3. è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆPythonï¼‰

**ä¼˜ç‚¹**: æ‰¹é‡æµ‹è¯•ã€è‡ªåŠ¨æŠ¥å‘Š

**è¿è¡Œ**:
```bash
python3 tests/run_instruction_tests.py
```

## ğŸ“ æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

### ç§»ä½æŒ‡ä»¤æµ‹è¯•

```
ASL zp,X (0x16):
  æµ‹è¯•ç”¨ä¾‹ 1: æ­£å¸¸å·¦ç§»
    è¾“å…¥: 0x42 â†’ è¾“å‡º: 0x84, C=0, N=1, Z=0
  
  æµ‹è¯•ç”¨ä¾‹ 2: è¿›ä½è®¾ç½®
    è¾“å…¥: 0x80 â†’ è¾“å‡º: 0x00, C=1, N=0, Z=1
  
  æµ‹è¯•ç”¨ä¾‹ 3: åœ°å€è®¡ç®—
    $10,X (X=5) â†’ åœ°å€ $15
    $10,X (X=FF) â†’ åœ°å€ $0F (å›ç»•)
```

### ç®—æœ¯æŒ‡ä»¤æµ‹è¯•

```
ADC zp (0x65):
  æµ‹è¯•ç”¨ä¾‹ 1: æ— è¿›ä½åŠ æ³•
    A=0x50, M=0x10, C=0 â†’ A=0x60, C=0, V=0
  
  æµ‹è¯•ç”¨ä¾‹ 2: æœ‰è¿›ä½åŠ æ³•
    A=0xFF, M=0x01, C=0 â†’ A=0x00, C=1, V=0
  
  æµ‹è¯•ç”¨ä¾‹ 3: æº¢å‡ºæµ‹è¯•
    A=0x50, M=0x50, C=0 â†’ A=0xA0, C=0, V=1
```

### JMP indirect ç‰¹æ®Šæµ‹è¯•

```
JMP ind (0x6C):
  æµ‹è¯•ç”¨ä¾‹ 1: æ­£å¸¸é—´æ¥è·³è½¬
    [0x1234] = 0x00, [0x1235] = 0x80 â†’ PC = 0x8000
  
  æµ‹è¯•ç”¨ä¾‹ 2: é¡µè¾¹ç•Œ bug
    [0x12FF] = 0x00, [0x1200] = 0x80 â†’ PC = 0x8000
    æ³¨æ„ï¼šä¸æ˜¯ [0x1300]ï¼è¿™æ˜¯ 6502 çš„ç¡¬ä»¶ bug
```

## ğŸ› å·²çŸ¥é—®é¢˜

### é«˜ä¼˜å…ˆçº§
1. **CPU è·³è½¬åˆ°å‘é‡è¡¨åŒºåŸŸ**
   - ç°è±¡: PC è·³è½¬åˆ° 0xFFFA ç­‰åœ°å€
   - å¯èƒ½åŸå› : æŸä¸ªæŒ‡ä»¤å®ç°æœ‰ bug
   - çŠ¶æ€: ğŸ”´ å¾…ä¿®å¤

### ä¸­ä¼˜å…ˆçº§
2. **æ ˆæŒ‡é’ˆå¼‚å¸¸å˜åŒ–**
   - ç°è±¡: SP ä» 0xE2 â†’ 0xC â†’ 0x7B
   - å¯èƒ½åŸå› : æ ˆæ“ä½œæŒ‡ä»¤æœ‰é—®é¢˜
   - çŠ¶æ€: ğŸŸ¡ è°ƒæŸ¥ä¸­

## ğŸ“š æ–‡æ¡£ç»“æ„

```
tests/
â”œâ”€â”€ TEST_CHECKLIST.md       # è¯¦ç»†æµ‹è¯•æ¸…å•ï¼ˆ500+ è¡Œï¼‰
â”œâ”€â”€ TEST_PROGRESS.md        # æµ‹è¯•è¿›åº¦è·Ÿè¸ªï¼ˆ200+ è¡Œï¼‰
â”œâ”€â”€ README.md               # æµ‹è¯•æ–‡æ¡£ï¼ˆ400+ è¡Œï¼‰
â”œâ”€â”€ FILES_SUMMARY.md        # æ–‡ä»¶æ€»ç»“ï¼ˆ250+ è¡Œï¼‰
â”œâ”€â”€ instruction_tests.asm   # æ±‡ç¼–æµ‹è¯•ç¨‹åº
â”œâ”€â”€ run_instruction_tests.py # Python è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆ200+ è¡Œï¼‰
â”œâ”€â”€ example_test.scala      # æµ‹è¯•ç¤ºä¾‹ï¼ˆ150+ è¡Œï¼‰
â””â”€â”€ test_roms/              # æµ‹è¯• ROM ç›®å½•

src/test/scala/
â””â”€â”€ InstructionTests.scala  # Scala å•å…ƒæµ‹è¯•ï¼ˆ150+ è¡Œï¼‰

docs/
â”œâ”€â”€ TESTING_GUIDE.md        # æµ‹è¯•æŒ‡å—ï¼ˆ300+ è¡Œï¼‰
â””â”€â”€ TEST_SUITE_SUMMARY.md   # æœ¬æ–‡ä»¶

scripts/
â”œâ”€â”€ run_tests.sh            # ä¸»æµ‹è¯•è„šæœ¬ï¼ˆ80+ è¡Œï¼‰
â”œâ”€â”€ verilator_build.sh      # Verilator ç¼–è¯‘
â”œâ”€â”€ verilator_run.sh        # Verilator è¿è¡Œ
â””â”€â”€ test_donkey_kong.sh     # Donkey Kong æµ‹è¯•
```

## ğŸ“ å­¦ä¹ èµ„æº

### æµ‹è¯•ç›¸å…³
1. **ChiselTest æ–‡æ¡£**: https://www.chisel-lang.org/chiseltest/
2. **ScalaTest æ–‡æ¡£**: https://www.scalatest.org/
3. **Verilator æ–‡æ¡£**: https://verilator.org/guide/latest/

### 6502 ç›¸å…³
1. **6502 æŒ‡ä»¤é›†**: http://www.6502.org/tutorials/6502opcodes.html
2. **Klaus æµ‹è¯•**: https://github.com/Klaus2m5/6502_65C02_functional_tests
3. **NES Dev Wiki**: https://wiki.nesdev.com/

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¦‚ä½•æ·»åŠ æµ‹è¯•

1. é€‰æ‹©ä¸€æ¡æŒ‡ä»¤ï¼ˆä¼˜å…ˆ P0ï¼‰
2. å‚è€ƒ `tests/example_test.scala` ç¼–å†™æµ‹è¯•
3. è¿è¡Œ `sbt test` éªŒè¯
4. æ›´æ–° `tests/TEST_PROGRESS.md`

### å¦‚ä½•æŠ¥å‘Šé—®é¢˜

1. åœ¨ `tests/TEST_PROGRESS.md` æ·»åŠ åˆ°"å·²çŸ¥é—®é¢˜"
2. åŒ…å«ï¼šæŒ‡ä»¤ã€é¢„æœŸã€å®é™…ã€å¤ç°æ­¥éª¤
3. æ ‡è®°ä¼˜å…ˆçº§ï¼šğŸ”´ é«˜ / ğŸŸ¡ ä¸­ / ğŸŸ¢ ä½

## ğŸ“ å‘½ä»¤é€ŸæŸ¥è¡¨

```bash
# æŸ¥çœ‹æ–‡æ¡£
cat tests/TEST_CHECKLIST.md
cat tests/TEST_PROGRESS.md
cat docs/TESTING_GUIDE.md

# è¿è¡Œæµ‹è¯•
./scripts/run_tests.sh
python3 tests/run_instruction_tests.py --priority P0
sbt test

# Verilator
./scripts/verilator_build.sh
./scripts/verilator_run.sh games/Donkey-Kong.nes

# åˆ†æ
python3 scripts/analyze_opcodes.py games/Donkey-Kong.nes
```

## ğŸ‰ æ€»ç»“

å·²åˆ›å»ºå®Œæ•´çš„æµ‹è¯•æ¡†æ¶ï¼ŒåŒ…æ‹¬ï¼š
- âœ… 1650+ è¡Œæµ‹è¯•æ–‡æ¡£
- âœ… 500+ è¡Œæµ‹è¯•ä»£ç 
- âœ… å®Œæ•´çš„æµ‹è¯•æ¸…å•ï¼ˆ151 ç§æŒ‡ä»¤ï¼‰
- âœ… è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
- âœ… è¯¦ç»†çš„æµ‹è¯•æŒ‡å—

**ä¸‹ä¸€æ­¥**: å¼€å§‹ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œä¼˜å…ˆæµ‹è¯• P0ï¼ˆå…³é”®ï¼‰æŒ‡ä»¤ï¼
